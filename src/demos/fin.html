<svg class="svg-fulscreen heart" viewBox="0 0 800 600">
  <filter
    id="filter-gooey"
    x="-20%" y="-20%" width="140%" height="140%" filterUnits="objectBoundingBox" primitiveUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
    <feGaussianBlur
      stdDeviation="10"
      x="0%" y="0%" width="100%" height="100%"
      edgeMode="none"
      in="SourceGraphic"
      result="blur"/>

    <feColorMatrix
      type="matrix"
      values="1 0 0 0 0
              0 1 0 0 0
              0 0 1 0 0
              0 0 0 19 -10"
      x="0%" y="0%" width="100%" height="100%"
      in="blur"
      result="colormatrix"/>
  </filter>

  <filter
    id="filter-heart-blur"
    x="-20%" y="-20%" width="140%" height="140%" filterUnits="objectBoundingBox" primitiveUnits="userSpaceOnUse" color-interpolation-filters="sRGB">

    <feGaussianBlur
      stdDeviation="1" x="0%" y="0%" width="100%" height="100%" edgeMode="none"
      result="blur"/>

    <feTurbulence
      type="fractalNoise" baseFrequency="0.05" numOctaves="1" seed="1" stitchTiles="stitch"
      result="turbulence"/>

    <feDisplacementMap
      scale="50"
      xChannelSelector="R" yChannelSelector="A"
      class="distortion-waves__map"
      in="blur" in2="turbulence"
      result="displacementMap"/>
  </filter>

  <mask id="mask"
    maskUnits="objectBoundingBox">
     <g filter="url(#filter-gooey)" fill="white">
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>
      <circle r="50" cx="50%" cy="50%" class="heart__mask-circle"/>

      <svg viewBox="0 0 400 600" preserveAspectRatio="xMidYMid meet">
        <svg viewBox="0 0 400 329" preserveAspectRatio="xMidYMid meet">
          <path d="M199.707062,328.924193 C306.1279,286.264571 371.305914,223.788236 395.241104,141.495189 C411.10542,86.9511117 389.083175,0.0955637558 302.216473,9.38591108e-05 C244.305338,-0.0635527387 210.135535,32.2422428 199.707062,96.9174805 C192.538642,32.3058894 159.023393,0.031917158 99.1613163,0.0955637558 C9.36820111,0.191033652 -11.317258,86.0580148 5.18615059,141.495189 C29.2163218,222.215775 94.0566258,284.692109 199.707062,328.924193 Z"></path>
        </svg>
      </svg>
    </g>
  </mask>

  <g
    mask="url(#mask)"
    filter="url(#filter-heart-blur)"
    fill="none"
    stroke-width="500"
    stroke-dasharray="52 260"
    class="heart__fill-circles-group">
    <circle r="250" cx="50%" cy="50%"
      stroke="crimson"
      class="heart__fill-circle"/>
    <circle r="250" cx="50%" cy="50%"
      stroke="gold"
      stroke-dashoffset="52"
      class="heart__fill-circle"/>
    <circle r="250" cx="50%" cy="50%"
      stroke="lightseagreen"
      stroke-dashoffset="104"
      class="heart__fill-circle"/>
    <circle r="250" cx="50%" cy="50%"
      stroke="yellowgreen"
      stroke-dashoffset="156"
      class="heart__fill-circle"/>
    <circle r="250" cx="50%" cy="50%"
      stroke="teal"
      stroke-dashoffset="208"
      class="heart__fill-circle"/>
    <circle r="250" cx="50%" cy="50%"
      stroke="orange"
      stroke-dashoffset="260"
      class="heart__fill-circle"/>
    <circle r="600" cx="50%" cy="50%"
      stroke-width="0"
      fill="transparent"/>
  </g>
</svg>

<script type="text/javascript">
  (function() {
    var requestAnimationFrame = window.requestAnimationFrame
      || window.mozRequestAnimationFrame
      || window.webkitRequestAnimationFrame
      || window.msRequestAnimationFrame;

    const circlesGroup = document.querySelector('.heart__fill-circles-group');
    const circlesElems = document.querySelectorAll('.heart__mask-circle');
    const circles = [];
    let isRunning = false;
    const groupAnimatedClass = 'heart__fill-circles-group--animated';

    const pathLength = 350;
    const maxSteps = 80;
    const maxR = 50;
    const rStep = maxR / maxSteps;

    const Circle = function({elem, direction, delay}) {
      this.elem = elem;
      this.direction = direction;
      this.delay = delay;

      this.resetValues();
    };

    Circle.prototype.resetValues = function() {
      const angleDeg = Math.round(Math.random() * 360);
      const angleRad = angleDeg * Math.PI/180;

      this.x = pathLength * Math.sin(angleRad); // c * sin(B)
      this.y = pathLength * Math.cos(angleRad); // c * cos(B)
      this.xStep = this.x / maxSteps;
      this.yStep = this.y / maxSteps;
      this.currentStep = maxSteps / 4.5;
    };

    Circle.prototype.changeProp = function() {
      if(!isRunning) {
        return;
      }

      let x = this.xStep * this.currentStep;
      let y = this.yStep * this.currentStep;

      if(this.direction === 1) {
        // right top
        y *= -1;
      }
      else if(this.direction === 2) {
        // right bottom
        // make nothing
      }
      else if(this.direction === 3) {
        // left bottom
        x *= -1;
      }
      else if(this.direction === 4) {
        // left top
        x *= -1;
        y *= -1;
      }

      this.currentStep++;

      this.elem.setAttribute('transform', `translate(${x}, ${y})`);
      this.elem.setAttribute('r', (Math.abs(maxSteps - this.currentStep)) * rStep);

      if(this.currentStep >= maxSteps) {
        this.resetValues();
      }

      requestAnimationFrame(() => {
        this.changeProp();
      });
    };

    function setInitial() {
      circles.forEach(circle => {
        circle.elem.setAttribute('transform', `translate(0, 0)`);
        circle.elem.setAttribute('r', maxR);
      })
    };

    const runAnimation = () => {
      circles.forEach((circle, i) => {
        setTimeout(() => {
          circle.resetValues();
          circle.changeProp();
        }, circle.delay);
      })
    };

    const prepareCircles = () => {
      circlesElems.forEach((elem, i) => {
        const direction = Math.floor(Math.random() * 4) + 1;
        const circle = new Circle({
          elem,
          direction,
          delay: i * 100
        });

        circles.push(circle);
      });
    }

    // ------------------------------

    prepareCircles();

    window['heart'] = {
      play: () => {
        if(!isRunning) {
          requestAnimationFrame(runAnimation);
          isRunning = true;
          circlesGroup.classList.add(groupAnimatedClass)
        }
      },
      pause: () => {
        setInitial();
        isRunning = false;
        circlesGroup.classList.remove(groupAnimatedClass)
      }
    };
  })(window);
</script>
